# ç¿å®AIè‹±è¯­å­¦ä¹ åŠ©æ‰‹ - åç«¯éƒ¨ç½²æŒ‡å—

## ğŸ“‹ æœåŠ¡å™¨è¦æ±‚

### æœ€ä½é…ç½®
- **CPU**: 1æ ¸
- **å†…å­˜**: 1GB
- **ç¡¬ç›˜**: 20GB
- **ç³»ç»Ÿ**: Ubuntu 20.04+ / CentOS 7+
- **ç½‘ç»œ**: 1Mbps

### æ¨èé…ç½®
- **CPU**: 2æ ¸
- **å†…å­˜**: 2GB
- **ç¡¬ç›˜**: 40GB
- **ç³»ç»Ÿ**: Ubuntu 22.04 LTS
- **ç½‘ç»œ**: 5Mbps

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. è¿æ¥åˆ°é˜¿é‡Œäº‘ECSæœåŠ¡å™¨

```bash
ssh root@your-server-ip
```

### 2. å®‰è£…Node.js 18+

```bash
# å®‰è£…Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# éªŒè¯å®‰è£…
node --version
npm --version
```

### 3. å®‰è£…MySQL 8.0

```bash
# å®‰è£…MySQL
sudo apt-get update
sudo apt-get install -y mysql-server

# å¯åŠ¨MySQLæœåŠ¡
sudo systemctl start mysql
sudo systemctl enable mysql

# å®‰å…¨é…ç½®
sudo mysql_secure_installation
```

é…ç½®MySQLï¼š
```bash
# ç™»å½•MySQL
sudo mysql -u root -p

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
CREATE DATABASE ruiding_english CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'ruiding'@'localhost' IDENTIFIED BY 'your_strong_password';
GRANT ALL PRIVILEGES ON ruiding_english.* TO 'ruiding'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 4. å®‰è£…Nginxï¼ˆç”¨ä½œåå‘ä»£ç†ï¼‰

```bash
sudo apt-get install -y nginx

# å¯åŠ¨Nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

### 5. ä¸Šä¼ åç«¯ä»£ç 

æ–¹å¼ä¸€ï¼šä½¿ç”¨Git
```bash
cd /var/www
sudo git clone your-repository-url
cd windsurf-project/backend
```

æ–¹å¼äºŒï¼šä½¿ç”¨SCP
```bash
# åœ¨æœ¬åœ°æ‰§è¡Œ
scp -r backend root@your-server-ip:/var/www/
```

### 6. é…ç½®ç¯å¢ƒå˜é‡

```bash
cd /var/www/backend
cp .env.example .env
nano .env
```

ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š
```env
PORT=3001
NODE_ENV=production

DB_HOST=localhost
DB_PORT=3306
DB_USER=ruiding
DB_PASSWORD=your_strong_password
DB_NAME=ruiding_english

JWT_SECRET=$(openssl rand -base64 32)
JWT_EXPIRE=7d

MONTHLY_PRICE=29
YEARLY_PRICE=299
FREE_TRIAL_DAYS=7

FRONTEND_URL=https://your-domain.com
```

### 7. å®‰è£…ä¾èµ–å¹¶åˆå§‹åŒ–æ•°æ®åº“

```bash
npm install --production
npm run init-db
```

### 8. é…ç½®Nginxåå‘ä»£ç†

åˆ›å»ºNginxé…ç½®æ–‡ä»¶ï¼š
```bash
sudo nano /etc/nginx/sites-available/ruiding-api
```

æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š
```nginx
server {
    listen 80;
    server_name api.your-domain.com;

    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # é™åˆ¶è¯·æ±‚ä½“å¤§å°
    client_max_body_size 10M;

    # è¶…æ—¶è®¾ç½®
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
}
```

å¯ç”¨é…ç½®ï¼š
```bash
sudo ln -s /etc/nginx/sites-available/ruiding-api /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 9. é…ç½®SSLè¯ä¹¦ï¼ˆLet's Encryptï¼‰

```bash
# å®‰è£…Certbot
sudo apt-get install -y certbot python3-certbot-nginx

# è·å–SSLè¯ä¹¦
sudo certbot --nginx -d api.your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

### 10. ä½¿ç”¨PM2ç®¡ç†Node.jsè¿›ç¨‹

```bash
# å®‰è£…PM2
sudo npm install -g pm2

# å¯åŠ¨åº”ç”¨
cd /var/www/backend
pm2 start server.js --name ruiding-api

# å¼€æœºè‡ªå¯åŠ¨
pm2 startup
pm2 save

# å¸¸ç”¨å‘½ä»¤
pm2 status          # æŸ¥çœ‹çŠ¶æ€
pm2 logs ruiding-api  # æŸ¥çœ‹æ—¥å¿—
pm2 restart ruiding-api  # é‡å¯
pm2 stop ruiding-api     # åœæ­¢
```

### 11. é…ç½®é˜²ç«å¢™

```bash
# å…è®¸HTTPå’ŒHTTPS
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp  # SSH
sudo ufw enable
```

### 12. é…ç½®æ—¥å¿—è½®è½¬

åˆ›å»ºæ—¥å¿—è½®è½¬é…ç½®ï¼š
```bash
sudo nano /etc/logrotate.d/ruiding-api
```

æ·»åŠ å†…å®¹ï¼š
```
/var/www/backend/logs/*.log {
    daily
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 root root
    sharedscripts
}
```

## ğŸ” éªŒè¯éƒ¨ç½²

### æµ‹è¯•APIæ¥å£

```bash
# å¥åº·æ£€æŸ¥
curl https://api.your-domain.com/health

# æµ‹è¯•æ³¨å†Œ
curl -X POST https://api.your-domain.com/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"test123"}'
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æŸ¥çœ‹åº”ç”¨æ—¥å¿—
```bash
pm2 logs ruiding-api
```

### æŸ¥çœ‹Nginxæ—¥å¿—
```bash
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### æŸ¥çœ‹MySQLæ—¥å¿—
```bash
sudo tail -f /var/log/mysql/error.log
```

### æ•°æ®åº“å¤‡ä»½

åˆ›å»ºå¤‡ä»½è„šæœ¬ï¼š
```bash
sudo nano /root/backup-db.sh
```

æ·»åŠ å†…å®¹ï¼š
```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/root/backups"
mkdir -p $BACKUP_DIR

mysqldump -u ruiding -p'your_password' ruiding_english | gzip > $BACKUP_DIR/ruiding_$DATE.sql.gz

# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "ruiding_*.sql.gz" -mtime +7 -delete
```

è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼š
```bash
chmod +x /root/backup-db.sh
crontab -e

# æ·»åŠ æ¯å¤©å‡Œæ™¨3ç‚¹å¤‡ä»½
0 3 * * * /root/backup-db.sh
```

## ğŸ” å®‰å…¨åŠ å›º

### 1. ç¦ç”¨root SSHç™»å½•
```bash
sudo nano /etc/ssh/sshd_config
# ä¿®æ”¹ï¼šPermitRootLogin no
sudo systemctl restart sshd
```

### 2. é…ç½®fail2ban
```bash
sudo apt-get install -y fail2ban
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

### 3. å®šæœŸæ›´æ–°ç³»ç»Ÿ
```bash
sudo apt-get update
sudo apt-get upgrade -y
```

## ğŸ› æ•…éšœæ’æŸ¥

### Node.jsåº”ç”¨æ— æ³•å¯åŠ¨
```bash
pm2 logs ruiding-api --lines 100
```

### æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
sudo systemctl status mysql
mysql -u ruiding -p -e "SELECT 1"
```

### Nginxé…ç½®é”™è¯¯
```bash
sudo nginx -t
sudo systemctl status nginx
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿè¯·æŸ¥çœ‹ï¼š
1. åº”ç”¨æ—¥å¿—ï¼š`pm2 logs`
2. Nginxæ—¥å¿—ï¼š`/var/log/nginx/`
3. MySQLæ—¥å¿—ï¼š`/var/log/mysql/`

## ğŸ‰ éƒ¨ç½²å®Œæˆï¼

æ‚¨çš„åç«¯æœåŠ¡ç°åœ¨åº”è¯¥è¿è¡Œåœ¨ï¼š
- **HTTP**: `http://api.your-domain.com`
- **HTTPS**: `https://api.your-domain.com`

è®°å¾—æ›´æ–°å‰ç«¯åº”ç”¨ä¸­çš„APIåœ°å€ï¼
